#!/bin/sh
#
# Runs formatting check and tests before each commit.
# Install: git config core.hooksPath .githooks

# Skip checks if src/ doesn't exist yet (pre-Ticket #1).
if [ ! -d "src" ]; then
    echo "pre-commit: no src/ directory, skipping checks."
    exit 0
fi

echo "pre-commit: checking formatting..."
zig fmt --check src/ 2>/dev/null
if [ $? -ne 0 ]; then
    echo ""
    echo "Formatting check failed. Run 'zig fmt src/' to fix."
    exit 1
fi

# Skip build/test if there's no build.zig yet.
if [ ! -f "build.zig" ]; then
    echo "pre-commit: no build.zig, skipping tests."
    exit 0
fi

echo "pre-commit: running tests..."
zig build test 2>&1
if [ $? -ne 0 ]; then
    echo ""
    echo "Tests failed. Fix failing tests before committing."
    exit 1
fi

echo "pre-commit: all checks passed."
